{% extends "admin/base_site.html" %}
{% load static %}
{% block content %}

<style>
  .content {
      max-width: 100% !important;
  }

  /* Shared table styles */
  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1000px;
  }

  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    vertical-align: top;
  }

  th {
    background-color: #f4f4f4;
    position: sticky;
    top: 0;
    z-index: 1;
  }

  ul {
    margin: 0;
    padding-left: 18px;
  }

  .sub-item {
    font-size: 14px;
    color: #555;
  }

  .no-items {
    color: #999;
    font-style: italic;
  }

  /* Scrollable container for each table */
  #management-orders,
  #customer-orders {
    max-height: 500px;
    overflow-y: auto;
    border: 1px solid #ccc;
    margin-top: 20px;
  }






 .custom-header {
  margin-top: 20px;
  font-size: 1.5rem; /* or whatever size you want */
  text-align: left;
  font-weight: 600;
}

.custom-paragraph {
  margin-bottom: 20px;
  font-size: 1rem;
  text-align: left;
}

.add-new-btn:hover {
    background-color: #0056b3 !important;
    color: #fff !important;
    text-decoration: none;
}
</style>

<div class="messagelist">
    {% for message in messages %}
        <div class="alert {{ message.tags }}">{{ message }}</div>
    {% endfor %}
</div>


<h1>Order Management System</h1>

<a href="{% url 'create_order' %}" class="button button-primary add-new-btn" style="margin-left: 20px; background-color: #007bff; color: #fff;">
    <h2 style="margin: 0;">+ Add New</h2>
</a>

{% if not user.is_authenticated %}
    <div class="errornote">You must be logged in to view this page.</div>
    <script>
        window.location.href = "{% url 'admin:login' %}?next={{ request.path }}";
    </script>
{% else %}
    <hr>
{% endif %}

<!-- Management Order History -->
<div style="float: left; width: 100%;">
    <h2 class="custom-header">Management Order History</h2>
    <p class="custom-paragraph">Here you can view all the orders placed by Management.</p>
</div>


<div id="management-orders" style="width: 100%;">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Phone</th>
        <th>Menu Item</th>
        <th>Amount</th>
        <th>Created At</th>
        <th>Status</th>
        <th>Items</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for order in admin_orders %}
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ order.name }}</td>
        <td>{{ order.phone }}</td>
        <td>{{ order.menu_item__name }}</td>
        <td>{{ order.amount }}</td>
        <td>{{ order.created_at }}</td>
        <td style="color:#007bff;">{{ order.status }}</td>
        <td>
          <ul>
            {% for item in order.items %}
            {% if item.quantity > 0 %}
              <li>
                  {{ item.ingredient__food }} - Qty: {{ item.quantity }} - Price: {{ item.price }}
              </li>
            {% endif %}
            {% endfor %}
          </ul>
        </td>
        <td>
          <form method="post" action="{% url 'management_site' %}?management_order_id={{ order.id }}" class="inline-status-form" title="Change Order Status">
            {% csrf_token %}
            <select name="status">
              <option value="requested" {% if order.status == 'requested' %}selected{% endif %}>Requested</option>
              <option value="cooking" {% if order.status == 'cooking' %}selected{% endif %}>Cooking</option>
              <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered</option>
              <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
            </select>
            <button type="submit" title="Save New Status" style="border: none; background: none;">
              ðŸ’¾
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>



<!-- Customer Order History -->
<div style="float: left; width: 100%;">
    <h2 class="custom-header">Customer Order History</h2>
    <p class="custom-paragraph">Here you can view all the orders placed by Customer.</p>
</div>


<div id="customer-orders" style="width: 100%;">
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Order ID</th>
        <th>Phone</th>
        <th>Email</th>
        <th>Order Date</th>
        <th>Status</th>
        <th>Amount</th>
        <th>Items</th>
        <th>Tables</th>
        <th>Payment</th>
        <th >Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for order in customer_orders %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ order.order_id }}</td>
        <td>{{ order.user__phone_number |default:"-" }}</td>
        <td>{{ order.user__email }}</td>
        <td>{{ order.order_date|date:"Y-m-d H:i" }}</td>
        <td style="color:#007bff;">{{ order.order_status }}</td>
        <td>{{ order.amount }}</td>
        <td>
          {% if order.items %}
            <ul>
              {% for item in order.items %}
              <li class="sub-item">
                {{ item.item_name }} (x{{ item.quantity }}) - {{ item.item_price }}
              </li>
              {% endfor %}
            </ul>
          {% else %}
            <span class="no-items">No items</span>
          {% endif %}
        </td>
        <td>
          {% for num in order.table_numbers %}
            {{ num }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </td>
        <td>
          {% if not order.is_order_verified %}
              CASH ON
          {% else %}
              PAID
          {% endif %}

        </td>
        <td>
          <form method="post" action="{% url 'management_site' %}?customer_order_id={{ order.id }}" class="inline-status-form" title="Change Order Status">
            {% csrf_token %}
            <select name="status">
              <option value="requested" {% if order.status == 'requested' %}selected{% endif %}>Requested</option>
              <option value="cooking" {% if order.status == 'cooking' %}selected{% endif %}>Cooking</option>
              <option value="served" {% if order.status == 'served' %}selected{% endif %}>Served</option>
              <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Delivered</option>
              <option value="cancelled" {% if order.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
            </select>
            <button type="submit" title="Save New Status" style="border: none; background: none;">
              ðŸ’¾
            </button>
          </form>
          <form method="post" action="{% url 'management_site' %}?customer_order_id={{ order.id }}" class="inline-status-form" title="Payment confirm">
              {% csrf_token %}
              <input type="hidden" name="payment_status" value="paid">
              <button type="submit" title="Payment confirm" style="border: none; background: none; cursor: pointer;">
                  PAID
              </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  document.getElementById("add-new-btn")?.addEventListener("click", function (e) {
    e.preventDefault();
    const form = document.getElementById("form-container");
    if (form) {
      form.style.display = form.style.display === "none" ? "block" : "none";
    }
  });
















  // change status
  
</script>

{% endblock %}
